# 潜在変数モデル

## 背景
構造方程式モデル（SEM）は観測変数と観測されない潜在変数（構成概念）間の複雑な関係性を同時に分析する多変量統計手法です。
汎用的なモデル表現によって，多くの統計モデルを下位モデルとして包摂します。

因子分析と重回帰分析という2つの主要な多変量手法を統合しており，理論モデルを検証することが主な目的です。

観測不能な概念（例：幸福感，計算能力）をモデルに組み込むことが可能であり，測定誤差を明示的に考慮できる点にも特徴があります。何より，潜在変数を含む変数間の相互依存関係を同時に評価できる点に強みがあります。

## SEMの発展
アメリカの遺伝学者Sewall Wrightが1918年にパス解析を開発し，当初は遺伝形質の継承パターンを分析するために利用されました。変数間のつながりを相関係数として定義し，グラフィカルモデル（パス図）を使用しました。

一方，Charles Spearman（1904年）やLouis Leon Thurstone（1935年）らが心理測定の領域で因子分析を開発しました。観測変数群の背後にある潜在的な「因子」を特定する手法です。これにより，知能や性格特性などの抽象概念の定量化が可能になります。

そして，経済システム内の複雑なネットワーク関係をマッピングする手法として主流となる，変数間の同時方程式モデルが経済学分野で開発されます。

パスモデル，因子分析，計量経済学の同時方程式モデルが統合され，観測変数と潜在変数の両方を含む複合的な分析が可能になりました。

## 社会科学における潜在変数の必要性
社会科学の研究者の課題として，幸福感や購買意欲，景気，適性，能力など直接観測できない多くの抽象的な構成概念をモデル化する必要性が挙げられます。

1930年代，回答者の意見の方向性と強度を評価し，社会調査に広く採用されることとなるリッカート尺度 (Likert Scale)が開発されます。

観測不能な量（潜在変数）を複数の観測可能な代理変数，指標変数を通じて測定する「三角測量」のアプローチが確立されました。

## SEMの普及と多様化
ソフトウェアの発展はめざましく，商用のソフトウェアとして，
LISREL，AMOS (IBM-SPSS) といったグラフィカルユーザーインターフェースを備えたソフトウェアが登場し，SEMの利用が容易になりました。EQSやMplus，特にMplusには定評があります。

一方，オープンソースのソフトウェアとして，**R**では，<code>lavaan</code>，<code>OpenMx</code>，<code>semPLS</code>などが開発され，研究者にとって費用をかけずにSEMを実践できる環境が拡大しています。

応用分野も拡大しており，社会科学，行動科学，教育学，心理学，マーケティング，経営管理などから，工学，コンピュータサイエンス，生物学などの自然科学分野にまで広がっています。

SEMには
* 潜在成長曲線 (Latent Growth Curve, LGC) モデル
* ベイズSEM (Bayesian SEM, BSEM)
* マルチレベル SEM (Multilevel SEM)
などの発展がみられ，より複雑な理論モデルを分析できるようになっています。

## 確認的因子分析モデル
潜在変数モデルの基本形として，**確認的因子分析モデル**（Confirmatory Factor Analysis; CFA）を実行します。

```{r}
require(tidyverse)
require(lavaan)
flnm <- "~/Downloads/personality.xlsx"
tbl_personality <- readxl::read_xlsx(flnm)
tbl_personality <- tbl_personality %>%
  rename(
    Agr1 = 関係1, Con1 = 意志1, Ext1 = 活動1, Emo1 = 情動1, Int1 = 堅実1,
    Agr2 = 関係2, Con2 = 意志2, Ext2 = 活動2, Emo2 = 情動2, Int2 = 堅実2,
    Agr3 = 関係3, Con3 = 意志3, Ext3 = 活動3, Emo3 = 情動3, Int3 = 堅実3,
    Agr4 = 関係4, Con4 = 意志4, Ext4 = 活動4, Emo4 = 情動4, Int4 = 堅実4,
    Agr5 = 関係5, Con5 = 意志5, Ext5 = 活動5, Emo5 = 情動5, Int5 = 堅実5
    )
  # Agreeableness       関係
  # Conscientiousness   意志
  # Extraversion        活動
  # Emotional Stability 情動
  # Intellect           堅実
mdl_personality <- '
  Agr =~ Agr1 + Agr2 + Agr3 + Agr4 + Agr5
  Con =~ Con1 + Con2 + Con3 + Con4 + Con5
  Ext =~ Ext1 + Ext2 + Ext3 + Ext4 + Ext5
  Emo =~ Emo1 + Emo2 + Emo3 + Emo4 + Emo5
  Int =~ Int1 + Int2 + Int3 + Int4 + Int5
'
rslt_personality <-
  cfa(model = mdl_personality, data = tbl_personality) # std.lv
summary(rslt_personality, standard = TRUE, rsquare = TRUE, ci = TRUE, fit.measure = TRUE)
```

適合度の一覧は関数<code>fitMeasures()</code>で得られます。
```{r}
fitMeasures(rslt_personality)
```

以下のようにすれば，特定の適合度指標を表示します。
```{r}
fitMeasures(rslt_personality, c("chisq", "df", "cfi", "rmsea"))
```

## 共分散構造分析
情動を他の因子で説明するモデルを分析してみましょう。


```{R}
mdl_prsn_sem <- '
  Agr =~ Agr1 + Agr2 + Agr3 + Agr4 + Agr5
  Con =~ Con1 + Con2 + Con3 + Con4 + Con5
  Ext =~ Ext1 + Ext2 + Ext3 + Ext4 + Ext5
  Emo =~ Emo1 + Emo2 + Emo3 + Emo4 + Emo5
  Int =~ Int1 + Int2 + Int3 + Int4 + Int5
  Emo ~ Agr + Con + Ext + Int
'
rslt_prsn_sem <-
  cfa(model = mdl_prsn_sem, data = tbl_personality)
summary(rslt_prsn_sem, standard = TRUE, rsquare = TRUE, ci = TRUE, fit.measure = TRUE)
```

パス図を出力するパッケージ<code>semPlot</code>を利用します。

```{r}
require(semPlot)
semPaths(rslt_prsn_sem, # 以下はおすすめ設定
  what = "std", style = "lisrel",
  edge.label.cex = 0.5,
  edge.color = "black", fade = FALSE,
  nCharNodes = 0
  #,sizeMan = 10, esize = 3 # 適宜変更
)
```
